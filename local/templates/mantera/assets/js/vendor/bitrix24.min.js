const API_URL="https://profservice24.bitrix24.ru/rest/752/c1fdvg25y8mdkc52/";function getRequestParams(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries())}function getCookies(){let a=[];return document.cookie.split(";").forEach(function(e,t){e=e.trim().split("=");a[e[0]]=e[1]}),a}function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function checkFields(e,t,a){let n="";return(!e.name||e.name.length<3)&&(n='Поле "Имя" Обязательно для заполнения!'),(!e.phone||e.phone.length<10)&&(n='Поле "Телефон" Обязательно для заполнения, и должно содержать больше 10 символов!'),"order"!==t&&"present"!==t&&"villas"!==t&&"penthouses"!==t||(e.email||(n='Поле "E-mail" обязательно для заполнения!'),validateEmail(e.email)||(n='Поле "E-mail" указано в неверном формате!')),a.removeAttribute("disabled"),!n||(alert(n),!1)}function setComment(e){let t="";var a;return e.comment&&(t+=e.comment),e.select_person&&(a=e.select_person,t="agency"===a?"Агентство: Да":"private_person"===a?"Частное лицо: Да":""),e.agency_name&&(t+=" Название агентства: "+e.agency_name),e.select_date_penthouses&&(a=e.select_date_penthouses,t="date_penthouses"===a?"Сообщить о дате presale по пентхаусам: Да":""),e.select_date_villas&&(e=e.select_date_villas,t="date_villas"===e?"Сообщить о дате presale по виллам: Да":""),t}function comagicSendData(e){window.Comagic&&Comagic.addOfflineRequest({name:e.name||"",email:e.email||"",phone:e.phone||"",message:e.comments||""})}function createLead(e){e.preventDefault();const t=e.target,a=document.getElementById(t.getAttribute("name"));var n=t.getAttribute("data-name"),o=t.getAttribute("data-title"),r=getCookies().SCBfrom,i=getRequestParams();console.log("modal",a);const s=t.querySelector('input[type="submit"]');s.setAttribute("disabled",!0);var c=t.querySelectorAll("input[type=text], input[type=email], input[type=tel], input[type=radio]:checked, input[type=checkbox]:checked"),l={};for(const u in c)if(c.hasOwnProperty(u)){const d=c[u];var m=d.value;l[d.getAttribute("name")||d.getAttribute("type")]=m}if(!checkFields(l,n,s))return!1;e=setComment(l);comagicSendData(l);i={fields:{TITLE:"Заявка с сайта mantera-group.com ("+o+") - "+l.name,SOURCE_DESCRIPTION:"Форма: "+o+" ["+n+"] mantera-group.com",NAME:l.name+" "+l.last_name,STATUS_ID:"NEW",SOURCE_ID:"STORE",OPENED:"Y",ASSIGNED_BY_ID:530,PHONE:[{VALUE:l.phone,VALUE_TYPE:"WORK"}],EMAIL:[{VALUE:l.email,VALUE_TYPE:"WORK"}],UF_CRM_1627910760409:r,UTM_CAMPAIGN:i.utm_campaign,UTM_CONTENT:i.utm_content,UTM_MEDIUM:i.utm_medium,UTM_SOURCE:i.utm_source,UTM_TERM:i.utm_term,COMMENTS:e},params:{REGISTER_SONET_EVENT:"Y"}},e=`${API_URL}crm.lead.add`;$.ajax({type:"POST",global:!0,dataType:"json",url:e,data:i,success:function(e){alert("Ваша заявка успешно отправлена!"),console.log("data",e),s.removeAttribute("disabled"),closeModal(a)},error:function(e){alert("Ошибка при отправке заявки, попробуйте еще раз!"),console.log("err",e),s.removeAttribute("disabled"),closeModal(a)}})}document.querySelectorAll("form[name^=fm]").forEach(e=>{e.addEventListener("submit",createLead)});